// @flow
import {AddressedChangeset, MapKey, True, False} from '$shared/DataVerse/types'
import {default as Tappable} from '$shared/DataVerse/utils/Tappable'
import {IDerivedArray} from '$shared/DataVerse/derivations/arrays/types'

type Unboxed<O> = $FixMe // eslint-disable-line no-unused-vars


// export type IsArrayAtom<V> = V['isArrayAtom']

export type IArrayAtom<V> = {
  isDictAtom: False,
  isBoxAtom: False,
  isArrayAtom: True,
  isAtom: True,
  isCompositeAtom: True,
  isPointer: False,

  _v: V,
  setIndex(key: number, v: V): $FixMe,
  index(index: number): V,
  push(rows: Array<V>): void,
  splice(startIndex: number, deleteCount: number, toAdd: Array<V>): void,
  pop(): undefined | null | V,
  shift(): undefined | null | V,
  head(): undefined | null | V,
  last(): undefined | null | V,
  unshift(row: V): void,

  changes(): Tappable<ArrayAtomChangeType<V>>,
  unboxDeep(): mixed,
  deepChanges(): Tappable<$FixMe>,
  deepDiffs(): Tappable<$FixMe>,

  _setParent(p: $FixMe, key: MapKey): void,
  _unsetParent(): void,
  getParent(): ?$FixMe,
  derivedArray(): IDerivedArray<V>,
}

declare function array<V, A: Array<V>>(a: A): IArrayAtom<V>

export default array

declare var ArrayAtom: Class<$FixMe>

export {ArrayAtom}